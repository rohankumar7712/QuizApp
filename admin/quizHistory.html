<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Quiz History - Admin Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f0f4ff, #e6f0ff);
  margin: 0; padding: 0;
}

/* Sidebar */
.sidebar {
  min-height: 100vh;
  background: linear-gradient(180deg, #6f42c1, #8e44ad);
  color: white;
  padding: 25px 15px;
}
.sidebar h4 { font-weight: bold; margin-bottom: 30px; font-size: 1.5rem; }
.sidebar a {
  color: white; display: block; padding: 12px; border-radius: 10px; margin-bottom: 5px;
  transition: 0.3s; font-weight: 500; text-decoration: none;
}
.sidebar a:hover, .sidebar a.active { background-color: rgba(255,255,255,0.15); }
.sidebar a.logout-link { color: #ffcccc !important; }
.sidebar a.logout-link:hover { background-color: #c0392b; color: white !important; }
.toggle-btn { display: none; font-size: 1.2rem; }

/* Card style */
.card {
  border-radius: 16px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  padding: 20px;
  transition: 0.3s;
}
.card:hover { transform: translateY(-6px); box-shadow: 0 12px 25px rgba(0,0,0,0.15); }

/* Professional buttons */
.btn-edit {
  border: 1px solid #6f42c1;
  color: #6f42c1;
  background: transparent;
  font-weight: 500;
  transition: 0.3s;
}
.btn-edit:hover { background: #6f42c1; color: white; }

.btn-delete {
  border: 1px solid #dc3545;
  color: #dc3545;
  background: transparent;
  font-weight: 500;
  transition: 0.3s;
}
.btn-delete:hover { background: #dc3545; color: white; }

/* Responsive */
@media (max-width: 768px) {
  .sidebar { position: fixed; width: 220px; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
  .sidebar.show { transform: translateX(0); }
  .toggle-btn { display: block; background-color: #6f42c1; color: white; border: none; padding: 10px 15px; margin: 10px; border-radius: 8px; }
}
</style>
</head>
<body>

<button class="toggle-btn" onclick="toggleSidebar()">â˜° Menu</button>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 sidebar" id="sidebar">
      <h4>Admin Panel</h4>
      <a class="nav-link" href="createQuiz.html"><i class="bi bi-plus-circle"></i> Create Quiz</a>
      <a class="nav-link active" href="quizHistory.html"><i class="bi bi-card-checklist"></i> Quiz History</a>
      <a class="nav-link" href="studentManage.html"><i class="bi bi-people"></i> Student Management</a>
      <a class="nav-link" href="performance.html"><i class="bi bi-bar-chart-line"></i> Student Performance</a>
      <a class="nav-link" href="studentAllowance.html"><i class="bi bi-check2-square"></i> Student Allowance</a>
      <hr class="text-white" />
      <a class="nav-link logout-link" href="../index.html"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </div>

    <!-- Main content -->
    <div class="col-md-9 p-4">
      <h3 class="mb-4">Quiz History</h3>
      <div id="quizList" class="row g-4">
        <!-- Quiz cards will be appended here -->
      </div>
    </div>
  </div>
</div>

<script>
function toggleSidebar(){document.getElementById("sidebar").classList.toggle("show");}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_lvF65P7vaKYnKEMrpHfJroMe-vh3w4U",
  authDomain: "quizapp-f370d.firebaseapp.com",
  projectId: "quizapp-f370d",
  storageBucket: "quizapp-f370d.appspot.com",
  messagingSenderId: "822956185807",
  appId: "1:822956185807:web:3d2244d53f9bb61ec33fba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function renderQuizzes() {
  const snapshot = await getDocs(collection(db, "quizzes"));
  const quizList = document.getElementById("quizList");
  quizList.innerHTML = "";

  const quizzes = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
  quizzes.sort((a,b)=>new Date(a.startAt)-new Date(b.startAt));

  quizzes.forEach((quiz)=>{
    const start = new Date(quiz.startAt).toLocaleString();
    const end = new Date(quiz.endAt).toLocaleString();

    const cardCol = document.createElement("div");
    cardCol.className = "col-md-6";
    cardCol.innerHTML = `
      <div class="card p-3">
        <h5>${quiz.title}</h5>
        <p>
          <strong>Quiz Code:</strong> ${quiz.quizCode || quiz.id}<br>
          <strong>Start:</strong> ${start}<br>
          <strong>End:</strong> ${end}
        </p>
        <div class="d-flex gap-2">
          <button class="btn btn-edit d-flex align-items-center gap-1" onclick="editQuiz('${quiz.id}')">
            <i class="bi bi-pencil-square"></i> Edit
          </button>
          <button class="btn btn-delete d-flex align-items-center gap-1" onclick="deleteQuiz('${quiz.id}')">
            <i class="bi bi-trash"></i> Delete
          </button>
        </div>
      </div>
    `;
    quizList.appendChild(cardCol);
  });
}

window.editQuiz = (quizId) => {
  localStorage.setItem("editQuizId", quizId);
  window.location.href = "createQuiz.html";
};

window.deleteQuiz = async (quizId) => {
  if(confirm("Are you sure you want to delete this quiz?")) {
    await deleteDoc(doc(db,"quizzes",quizId));
    renderQuizzes();
  }
};

renderQuizzes();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
