<!-- ========================= quizHistory.html ========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz History - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f5f9f8; font-family: 'Segoe UI', sans-serif; }
    .sidebar { min-height: 100vh; background-color: #6f42c1; color: white; padding: 20px 10px; }
    .sidebar h4 { font-weight: bold; margin-bottom: 30px; }
    .sidebar a { color: white; text-decoration: none; display: block; padding: 10px; border-radius: 8px; transition: background-color 0.3s ease; cursor: pointer; }
    .sidebar a:hover, .sidebar a.active { background-color: #5a32a3; }
    .sidebar a.logout-link { color: #ffcccc !important; }
    .sidebar a.logout-link:hover { background-color: #c0392b; color: white !important; }
    .btn-purple { background: #6f42c1; color: white; }
    .btn-purple:hover { background: #5a32a3; }
    .toggle-btn { display: none; }
    @media (max-width: 768px) {
      .sidebar { position: fixed; width: 200px; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
      .sidebar.show { transform: translateX(0); }
      .toggle-btn { display: block; background-color: #6f42c1; color: white; border: none; padding: 10px 15px; margin: 10px; }
    }
  </style>
</head>
<body>

<!-- Toggle button for mobile -->
<button class="toggle-btn" onclick="toggleSidebar()">â˜° Menu</button>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 sidebar" id="sidebar">
      <h4>Admin Panel</h4>
      <a class="nav-link" href="createQuiz.html">Create Quiz</a>
      <a class="nav-link" href="quizHistory.html">Quiz History</a>
      <a class="nav-link" href="studentManage.html">Student Management</a>
      <a class="nav-link" href="performance.html">Student Performance</a>
      <a class="nav-link" href="studentAllowance.html">Student Allowance</a>

      <hr class="text-white">
      <a class="nav-link logout-link" href="../index.html">Logout</a>
    </div>

    <!-- Main content -->
    <div class="col-md-9 p-4">
      <h3 class="mb-4">Quiz History</h3>
      <!-- Two-column container for zig-zag layout -->
      <div id="quizList" class="row g-4">
        <div id="colLeft" class="col-md-6"></div>
        <div id="colRight" class="col-md-6"></div>
      </div>
    </div>
  </div>
</div>

<script>
function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("show");
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_lvF65P7vaKYnKEMrpHfJroMe-vh3w4U",
  authDomain: "quizapp-f370d.firebaseapp.com",
  projectId: "quizapp-f370d",
  storageBucket: "quizapp-f370d.appspot.com",
  messagingSenderId: "822956185807",
  appId: "1:822956185807:web:3d2244d53f9bb61ec33fba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const quizRef = collection(db, "quizzes");

async function renderQuizzes() {
  const snapshot = await getDocs(quizRef);

  const colLeft = document.getElementById("colLeft");
  const colRight = document.getElementById("colRight");
  colLeft.innerHTML = "";
  colRight.innerHTML = "";

  // Convert snapshot to array and sort by startAt
  const quizzes = snapshot.docs.map(docSnap => ({
    id: docSnap.id,
    ...docSnap.data()
  }));
  quizzes.sort((a, b) => new Date(a.startAt) - new Date(b.startAt));

  // Append cards in zig-zag: even -> left, odd -> right
  quizzes.forEach((quiz, index) => {
    const start = new Date(quiz.startAt).toLocaleString();
    const end = new Date(quiz.endAt).toLocaleString();

    const card = document.createElement("div");
    card.className = "card shadow-sm mb-4";
    card.innerHTML = `
      <div class="card-body">
        <h5 class="card-title">${quiz.title}</h5>
        <p class="card-text">
          <strong>Quiz Code:</strong> ${quiz.quizCode || quiz.id}<br>
          <strong>Start:</strong> ${start}<br>
          <strong>End:</strong> ${end}
        </p>
        <button class="btn btn-sm btn-primary me-2" onclick="editQuiz('${quiz.id}')">Edit</button>
        <button class="btn btn-sm btn-danger" onclick="deleteQuiz('${quiz.id}')">Delete</button>
      </div>
    `;

    if (index % 2 === 0) {
      colLeft.appendChild(card);
    } else {
      colRight.appendChild(card);
    }
  });
}

window.editQuiz = (quizId) => {
  localStorage.setItem("editQuizId", quizId);
  window.location.href = "createQuiz.html";
};

window.deleteQuiz = async function (quizId) {
  if (confirm("Are you sure you want to delete this quiz?")) {
    await deleteDoc(doc(db, "quizzes", quizId));
    renderQuizzes();
  }
};

renderQuizzes();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!-- ========================= END quizHistory.html ========================= -->
