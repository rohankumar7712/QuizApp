<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Student Management - Admin Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f0f4ff, #e6f0ff);
  margin: 0; padding: 0;
}

/* Sidebar */
.sidebar {
  min-height: 100vh;
  background: linear-gradient(180deg, #6f42c1, #8e44ad);
  color: white;
  padding: 25px 15px;
}
.sidebar h4 { font-weight: bold; margin-bottom: 30px; font-size: 1.5rem; }
.sidebar a {
  color: white; display: block; padding: 12px; border-radius: 10px; margin-bottom: 5px;
  transition: 0.3s; font-weight: 500; text-decoration: none;
}
.sidebar a:hover, .sidebar a.active { background-color: rgba(255,255,255,0.15); }
.sidebar a.logout-link { color: #ffcccc !important; }
.sidebar a.logout-link:hover { background-color: #c0392b; color: white !important; }
.toggle-btn { display: none; font-size: 1.2rem; }

/* Form card */
.form-card {
  border-radius: 16px;
  background: linear-gradient(145deg, #ffffff, #f2f5ff);
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  padding: 25px;
  margin-bottom: 20px;
  transition: all 0.3s ease;
}
.form-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

/* Buttons */
.btn-edit {
  border: 1px solid #6f42c1;
  color: #6f42c1;
  background: transparent;
  font-weight: 500;
  transition: 0.3s;
}
.btn-edit:hover { background: #6f42c1; color: white; }

.btn-delete {
  border: 1px solid #dc3545;
  color: #dc3545;
  background: transparent;
  font-weight: 500;
  transition: 0.3s;
}
.btn-delete:hover { background: #dc3545; color: white; }

/* Table */
.table tbody tr:hover { background-color: rgba(111,66,193,0.05); }

/* Responsive */
@media (max-width: 768px) {
  .sidebar { position: fixed; width: 220px; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
  .sidebar.show { transform: translateX(0); }
  .toggle-btn { display: block; background-color: #6f42c1; color: white; border: none; padding: 10px 15px; margin: 10px; border-radius: 8px; }
}
</style>
</head>
<body>

<button class="toggle-btn" onclick="toggleSidebar()">â˜° Menu</button>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 sidebar" id="sidebar">
      <h4>Admin Panel</h4>
      <a class="nav-link active" href="createQuiz.html"><i class="bi bi-plus-circle"></i> Create Quiz</a>
      <a class="nav-link" href="quizHistory.html"><i class="bi bi-card-checklist"></i> Quiz History</a>
      <a class="nav-link" href="studentManage.html"><i class="bi bi-people"></i> Student Management</a>
      <a class="nav-link" href="performance.html"><i class="bi bi-bar-chart-line"></i> Student Performance</a>
      <a class="nav-link" href="studentAllowance.html"><i class="bi bi-check2-square"></i> Student Allowance</a>
      <hr class="text-white" />
      <a class="nav-link logout-link" href="../index.html"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </div>

    <div class="col-md-9 p-4">
      <h3 class="mb-4">Student Management</h3>

      <div class="form-card mb-4">
        <form id="addStudentForm">
          <div class="row g-3">
            <div class="col-md-4">
              <input type="text" id="name" class="form-control" placeholder="Student Name" required />
            </div>
            <div class="col-md-4">
              <input type="email" id="email" class="form-control" placeholder="Student Email" required />
            </div>
            <div class="col-md-4">
              <input type="password" id="password" class="form-control" placeholder="Password" required />
            </div>
            <div class="col-md-12 mt-2">
              <button type="submit" class="btn btn-edit"><i class="bi bi-person-plus"></i> Add Student</button>
            </div>
          </div>
        </form>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Password</th>
              <th>Registered Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentTable"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("show");
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_lvF65P7vaKYnKEMrpHfJroMe-vh3w4U",
  authDomain: "quizapp-f370d.firebaseapp.com",
  projectId: "quizapp-f370d",
  storageBucket: "quizapp-f370d.appspot.com",
  messagingSenderId: "822956185807",
  appId: "1:822956185807:web:831411b98aacc662c33fba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const studentRef = collection(db, "students");
const table = document.getElementById("studentTable");

async function renderStudents() {
  const snapshot = await getDocs(studentRef);
  table.innerHTML = "";
  snapshot.forEach(docSnap => {
    const student = docSnap.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${student.name}</td>
      <td>${student.email}</td>
      <td>${student.password || 'N/A'}</td>
      <td>${student.createdAt?.toDate?.().toLocaleString() || 'N/A'}</td>
      <td class="d-flex gap-2">
        <button class="btn btn-edit btn-sm d-flex align-items-center gap-1" onclick="editStudent('${docSnap.id}')">
          <i class="bi bi-pencil-square"></i> Edit
        </button>
        <button class="btn btn-delete btn-sm d-flex align-items-center gap-1" onclick="deleteStudent('${docSnap.id}')">
          <i class="bi bi-trash"></i> Delete
        </button>
      </td>
    `;
    table.appendChild(tr);
  });
}

window.deleteStudent = async function(id) {
  if (confirm("Delete this student?")) {
    await deleteDoc(doc(db, "students", id));
    renderStudents();
  }
};

window.editStudent = async function(id) {
  alert("Edit functionality can be implemented here (prefill form for updates)");
};

document.getElementById("addStudentForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if (!name || !email || !password) { alert("All fields are required."); return; }
  await addDoc(studentRef, { name, email, password, createdAt: serverTimestamp() });
  e.target.reset();
  renderStudents();
});

renderStudents();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
